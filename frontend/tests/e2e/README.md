# E2Eテスト仕様書

## 対応ブラウザ・デバイス

### ✅ サポート対象
- **Desktop Chrome** (最新版)
- **Desktop Safari** (最新版)
- **Mobile Chrome** (Pixel 5エミュレーション)
- **Mobile Safari** (iPhone 12エミュレーション)

### ❌ 動作保証外
- **Firefox** (デスクトップ・モバイル)
- **Internet Explorer / Edge Legacy**
- その他のブラウザ

## テスト構成

### 📁 テストファイル
- `basic-ui-test.spec.ts` - 基本UI動作確認 (3テスト)
- `complete-user-flow.spec.ts` - 基本ユーザーフロー (3テスト)
- `visual-regression.spec.ts` - 基本ビジュアルテスト (7テスト)
- `test-suite-optimization.spec.ts` - テストスイート最適化・統合テスト (17テスト)

**総テスト数：120テスト** (4ブラウザ × 30テストケース)

### 🗑️ 削除されたテストファイル（実装対象外）
- ~~`bill-duplicate-check.spec.ts`~~ - 複雑な重複チェック機能未実装
- ~~`performance-advanced.spec.ts`~~ - 高度パフォーマンス測定機能未実装
- ~~`bill-items-display.spec.ts`~~ - 詳細品目表示機能未実装
- ~~`responsive-cross-platform.spec.ts`~~ - 複雑なクロスプラットフォーム機能未実装

## 実行コマンド

### 📊 基本実行
```bash
# 全テスト実行
npm run test:e2e

# 特定ブラウザのみ実行
npm run test:e2e -- --project=chromium

# UIモードで実行（利用可能な場合）
npm run test:e2e:ui

# デバッグモード（利用可能な場合）
npm run test:e2e:debug
```

### 🎯 テスト分類実行
```bash
# スモークテスト（最優先）
npm run test:e2e -- --grep="スモークテスト"

# 回帰テスト
npm run test:e2e -- --grep="回帰テスト"

# 統合テスト
npm run test:e2e -- --grep="統合テスト"

# 基本UIテスト
npm run test:e2e -- --grep="基本UI"

# ビジュアルテスト
npm run test:e2e -- --grep="基本ビジュアルテスト"
```

### 🛠️ Makefileコマンド（利用可能な場合）
```bash
make test-e2e         # フルスタック環境
make test-e2e-ui      # UIモード
make test-e2e-fast    # 高速実行
make test-e2e-smoke   # スモークテストのみ
```

## テストシナリオ

### 🔍 基本UI
- ログインページ要素確認
- 新規登録モード切り替え
- フォームバリデーション表示

### 🔄 基本ユーザーフロー
- 既存ユーザーログイン・ページナビゲーション
- 新規登録フォームのバリデーション
- 存在しないアカウントでのログインエラー

### 👁️ 基本ビジュアルテスト
- ログインページの基本表示確認
- 家計簿一覧ページの基本要素表示
- レスポンシブデザインの基本確認（モバイル・タブレット）

### 🎯 テストスイート最適化・統合
- **スモークテスト（優先度: 最高）**
  - クリティカルパス: ログイン機能
  - クリティカルパス: 家計簿一覧表示
  - クリティカルパス: 新規作成モーダル表示

- **回帰テスト（優先度: 高）**
  - 重複チェック機能の動作確認
  - フォームバリデーション動作確認

- **統合テスト（優先度: 中）**
  - 新規登録フォーム基本テスト
  - エラーハンドリングの統合テスト

- **UI/UXテスト（優先度: 中）**
  - レスポンシブデザイン: モバイルビュー
  - レスポンシブデザイン: タブレットビュー
  - キーボードナビゲーション

- **パフォーマンステスト（優先度: 低）**
  - ページロード時間測定
  - 大量操作時のパフォーマンス

- **ビジュアルリグレッション（優先度: 低）**
  - 重要画面のビジュアル確認

- **並列実行最適化テスト**
  - 並列テスト実行の動作確認

## 実装されていない機能

以下の機能は実装対象外のため、対応するテストは削除されています：

- **ダークモード対応** - UI実装なし
- **高度パフォーマンス測定** - Core Web Vitals、メモリリーク検出等
- **複雑な品目管理** - 詳細表示、編集機能等
- **複雑な重複チェック** - リアルタイム検証、API連携等
- **クロスプラットフォーム対応** - 高度なタッチ操作、デバイス固有機能等

## 技術仕様

- **フレームワーク**: Playwright
- **言語**: TypeScript
- **設定ファイル**: `playwright.config.ts`
- **レポート**: HTML形式
- **並列実行**: 最大4ワーカー
- **実行時間**: 約15秒（Chromiumのみ）、約2分（全ブラウザ）
- **成功率**: 100%（実装済み機能のみテスト）

## トラブルシューティング

### よくある問題
1. **テストタイムアウト**: Docker コンテナが起動していることを確認
2. **認証エラー**: テストデータに 'e2etest' ユーザーが存在することを確認
3. **要素が見つからない**: 実装されていない機能のテストが実行されていないか確認

### デバッグ方法
```bash
# ヘッドレスモードを無効化してテスト実行
npm run test:e2e -- --headed

# 特定のテストのみ実行
npm run test:e2e -- --grep="ログイン機能"

# HTML レポートを表示
npx playwright show-report
```
